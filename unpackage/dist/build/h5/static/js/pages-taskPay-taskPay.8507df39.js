(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-taskPay-taskPay"],{"26b4":function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=n(s("e378")),i=n(s("0089"));function n(t){return t&&t.__esModule?t:{default:t}}var d={data:function(){return{payDates:{},isDisabled:!1,isOldPayPasswordModel:!1,Length:6,isFocus:!0,Value:"",ispassword:!0,couponId:"",payTypeList:[{icon:"../../static/icon/money.png",title:"鹿币"},{icon:"../../static/icon/icon-balance.png",title:"余额"},{icon:"../../static/icon/wx.png",title:"微信支付"}],couponList:"",couponListPrice:"",fetchsTotalPrice:"",findsTotalPrice:"",fetchs:"",finds:"",taskPayList:"",address:"",companyaddress:[{address:"",tag:"",consignee:"",mobile:""}],balance_amount:"",virtual_amount:"",payTypeCheckIndex:0,task_ids:""}},onLoad:function(t){var a=t.payMethed;1==a?uni.setStorageSync("method",0):uni.setStorageSync("method",1),uni.setStorageSync("status",0),this.getUserAsset();var s=uni.getStorageSync("taskPayList"),e=s.finds,i=s.fetchs,n=s.task_ids,d=0,o=0;e.forEach(function(t){d+=parseFloat(t.fee)}),i.forEach(function(t){o+=parseFloat(t.fee)}),this.$data.taskPayList=s,this.$data.finds=e,this.$data.fetchs=i,this.$data.task_ids=n,this.$data.findsTotalPrice=d,this.$data.fetchsTotalPrice=o,this.getDefaultAddress(),this.getCompanyaddress()},onShow:function(){var t=this;this.$data.isDisabled=!1,this.$eventHub.$on("taskPayPage",function(a){t.$data.address=a.address,t.getServicePrice()})},mounted:function(){var t=this;this.$eventHub.$on("giftData",function(a){t.$data.couponList=a,t.$data.couponListPrice=a.value,t.$data.couponId=a.id})},methods:{goCoupon:function(){var t=this.$data.findsTotalPrice+this.$data.fetchsTotalPrice;uni.navigateTo({url:"../giftCertificate/giftCertificate?from=giftCertificate&totalPrice="+t})},getDefaultAddress:function(){var t=this,a=this;i.default.defaultAddress({}).then(function(s){200!=s.code&&0!=s.code||(t.$data.address=s.data,a.getServicePrice())})},getServicePrice:function(){var t=this;i.default.apiTaskPayment({method:"POST",data:{task_id:this.$data.taskPayList.task_ids,address_id:this.$data.address.id}}).then(function(a){if(200==a.code||0==a.code){var s=[],e=[],i=t.$data.taskPayList;a.data.forEach(function(t,a){1==t.type?i.finds.forEach(function(a,e){t.id==a.id&&(t.address=a.address,s.push(t))}):i.fetchs.forEach(function(a,s){t.id==a.id&&(t.address=a.address,e.push(t))})});var n=0,d=0;s.forEach(function(t){n+=parseFloat(t.total_fee)}),e.forEach(function(t){d+=parseFloat(t.total_fee)}),t.$data.finds=s,t.$data.fetchs=e,t.$data.findsTotalPrice=n,t.$data.fetchsTotalPrice=d}})},getCompanyaddress:function(){var t=this;i.default.getCompanyaddress({}).then(function(a){200!=a.code&&0!=a.code||(console.log("公司地址"),console.log(a.data.address),t.$data.companyaddress=a.data)})},getUserAsset:function(){var t=this;i.default.getUserAsset({}).then(function(a){200!=a.code&&0!=a.code||(t.$data.balance_amount=a.data.balance,t.$data.virtual_amount=a.data.virtual)})},goConsigneeAddress:function(t){wx.navigateTo({url:"../address/address?from=taskPayPage"})},payTypeCheck:function(t){this.$data.payTypeCheckIndex=t.currentTarget.dataset.index},doPay:function(){var t=this;this.$data.isDisabled=!0;var a=this;if(this.$data.payDates.task_ids=this.$data.task_ids,""!=this.$data.couponList?this.$data.couponListPrice=Math.ceil(this.$data.couponList.value):this.$data.couponListPrice=0,""==this.$data.address)return e.default.errorTips("请添加地址"),!1;if(2==this.$data.payTypeCheckIndex)console.log("微信支付"),i.default.wxPayByOrder({method:"POST",data:{type:"miniapp",open_id:uni.getStorageSync("open_id"),task_id:this.$data.task_ids,coupon_id:this.$data.couponId,address_id:this.$data.address.id}}).then(function(s){if(e.default.errorTips(s),200==s.code||0==s.code){var i=s.data.data,n=s.data.pay;i.success=function(t){console.log("支付成功"),console.log(t),uni.redirectTo({url:"../taskPaySuccess/taskPaySuccess?pay_log="+JSON.stringify(n)})},i.fail=function(t){a.$data.isDisabled=!1,e.default.errorTips(支付失败)},wx.requestPayment(i)}else e.default.errorTips("支付失败"),t.$data.isDisabled=!1}).catch(function(a){e.default.errorTips(a.msg),t.$data.isDisabled=!1});else{console.log("余额支付");var s=this;uni.showModal({title:"提示",content:"确认支付吗?",success:function(t){if(t.confirm){var a="";1==s.$data.payTypeCheckIndex?a={type:"miniapp",asset_type:"balance",open_id:uni.getStorageSync("open_id"),task_id:s.$data.task_ids,coupon_id:s.$data.couponId,address_id:s.$data.address.id}:0==s.$data.payTypeCheckIndex&&(a={type:"miniapp",asset_type:"virtual",open_id:uni.getStorageSync("open_id"),task_id:s.$data.task_ids,coupon_id:s.$data.couponId,address_id:s.$data.address.id}),i.default.payAsset({method:"POST",data:a}).then(function(t){if(200==t.code||0==t.code){var a=JSON.stringify(t.data.pay);uni.redirectTo({url:"../taskPaySuccess/taskPaySuccess?pay_log="+a})}else e.default.errorTips(t.msg),s.$data.isDisabled=!1}).catch(function(t){e.default.errorTips(t.msg),s.$data.isDisabled=!1})}else t.cancel&&(e.default.errorTips("你点击了取消"),s.$data.isDisabled=!1)}})}}}};a.default=d},3951:function(t,a,s){"use strict";s.r(a);var e=s("9f0d"),i=s("8c29");for(var n in i)"default"!==n&&function(t){s.d(a,t,function(){return i[t]})}(n);s("c429");var d=s("2877"),o=Object(d["a"])(i["default"],e["a"],e["b"],!1,null,"1f1fea4c",null);a["default"]=o.exports},"87df":function(t,a,s){var e=s("db2e");"string"===typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);var i=s("4f06").default;i("5e954ea0",e,!0,{sourceMap:!1,shadowMode:!1})},"8c29":function(t,a,s){"use strict";s.r(a);var e=s("26b4"),i=s.n(e);for(var n in e)"default"!==n&&function(t){s.d(a,t,function(){return e[t]})}(n);a["default"]=i.a},"9f0d":function(t,a,s){"use strict";var e=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("v-uni-view",[s("v-uni-view",{staticClass:"task-warp"},[s("v-uni-view",[t.finds.length>0?s("v-uni-view",{staticClass:"task-find box-shadow"},[s("v-uni-view",{staticClass:"task-find-title fs30"},[s("v-uni-text",[t._v("找料任务")])],1),t._l(t.finds,function(a,e){return s("v-uni-view",{key:e,staticClass:"task-find-list fs30"},[s("v-uni-view",{staticClass:"task-find-item"},[s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"},[t._v("物料品类:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.cname))]),1==a.find_type?s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("按图找料")]):t._e(),2==a.find_type?s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("按样找料")]):t._e(),3==a.find_type?s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("按描述找料")]):t._e()],1),s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"},[t._v("物料描述:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.desc))]),s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("金额:￥"+t._s(a.fee))])],1),s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"},[t._v("比价优选:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v("参考价格￥"+t._s(a.reference_price))])],1),s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"}),s("v-uni-text",{staticClass:"fs24 text-999"},[t._v(t._s(a.distance_text))]),s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("超范围服务费:￥"+t._s(a.extra_fee))])],1)],1),s("v-uni-view",{staticClass:"task-find-method"},[1==a.find_type?s("v-uni-view",{staticClass:"task-find-method-img"},t._l(a.desc_img,function(a,e){return s("v-uni-image",{key:e,attrs:{src:a},on:{click:function(a){a=t.$handleEvent(a),t.imgYu(a)}}})}),1):t._e(),2==a.find_type?s("v-uni-view",{staticClass:"task-find-method-getfind"},[s("v-uni-view",[s("v-uni-view",{staticClass:"fs24"},[s("v-uni-text",{staticClass:"fs28"},[t._v("取样地址:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.address.address||"")+" "+t._s(a.address.room||""))])],1)],1)],1):t._e(),3==a.find_type?s("v-uni-view",{staticClass:"task-find-method-getfind"},[s("v-uni-view",{staticClass:"mgl-20 fs32"},[t._v("寄样地址：")]),s("v-uni-view",[s("v-uni-view",{staticClass:"fs24 pdr-20",staticStyle:{"word-break":"break-all"}},[s("v-uni-text",{staticClass:"remark"},[t._v(t._s(t.companyaddress[0].tag))]),t._v(t._s(t.companyaddress[0].address))],1),s("v-uni-view",{staticClass:"fs24 pdr-20",staticStyle:{"word-break":"break-all"}},[t._v(t._s(t.companyaddress[0].consignee)+" / "+t._s(t.companyaddress[0].mobile))]),s("v-uni-view",[t._v("...")])],1)],1):t._e()],1)],1)}),s("v-uni-view",{staticClass:"task-find-sum lh90 fs30 bb-1"},[s("v-uni-text",[t._v("共"+t._s(t.finds.length)+"个任务,小计："),s("v-uni-text",{staticClass:"text-red"},[t._v("￥"+t._s(t.findsTotalPrice))])],1)],1)],2):t._e(),t.fetchs.length>0?s("v-uni-view",{staticClass:"task-get box-shadow"},[s("v-uni-view",{staticClass:"task-find-title fs30"},[s("v-uni-text",[t._v("取送任务")])],1),t._l(t.fetchs,function(a,e){return s("v-uni-view",{key:e,staticClass:"task-find-list fs30"},[s("v-uni-view",{staticClass:"task-find-item"},[s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"},[t._v("物料品类:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.cname))]),s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("金额:￥"+t._s(a.fee))])],1),s("v-uni-view",[s("v-uni-text",{staticClass:"fs28"},[t._v("物料描述:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.desc))]),s("v-uni-text",{staticClass:"flr text-yellow fs24"},[t._v("超范围服务费:￥"+t._s(a.extra_fee))])],1)],1),s("v-uni-view",{staticClass:"task-find-method"},[s("v-uni-view",{staticClass:"task-find-method-getfind fecth-address fs30"},[s("v-uni-view",{staticClass:"fs24"},[s("v-uni-text",{staticClass:"fs28"},[t._v("取料地址:")]),s("v-uni-text",{staticClass:"fs24 text-999 mgl-20"},[t._v(t._s(a.address.city_str||"")+" "+t._s(a.address.address||"")+" "+t._s(a.address.room||""))])],1)],1)],1)],1)}),s("v-uni-view",{staticClass:"task-find-sum lh90 fs30 bb-1"},[t._v("共"+t._s(t.fetchs.length)+"个任务,小计："),s("v-uni-text",{staticClass:"text-red"},[t._v("￥"+t._s(t.fetchsTotalPrice))])],1)],2):t._e()],1),s("v-uni-view",{staticClass:"fs30 bottom-border task-get box-shadow"},[s("v-uni-view",{staticClass:"cell-padding fs30 mgt-30 lh90 bottom-border"},[t._v("送料地址")]),s("v-uni-view",{staticClass:"cell-padding address flex flex-start",attrs:{"data-index":2},on:{click:function(a){a=t.$handleEvent(a),t.goConsigneeAddress(a)}}},[s("v-uni-text",{staticClass:"iconfont icon-jiantou address-icon"}),""!=t.address?s("v-uni-view",{staticClass:"flex-1 address-info fs30 pdt-30"},[s("v-uni-view",{staticClass:"fs2"},[s("v-uni-text",[t._v("收货人")]),t._v(t._s(t.address.mobile||"")),""!=t.address.remark?s("v-uni-text",{staticClass:"remark"},[t._v(t._s(t.address.remark||""))]):t._e()],1),s("v-uni-view",{staticClass:"fs24 text-999"},[t._v(t._s(t.address.city_str||"")+" "+t._s(t.address.address||"")+" "+t._s(t.address.room||""))])],1):t._e(),""==t.address?s("v-uni-view",{staticClass:"text-666 h100 lh100 flex-1 fetchsAddress",attrs:{"data-index":2},on:{click:function(a){a=t.$handleEvent(a),t.goConsigneeAddress(a)}}},[t._v("点击添加取料地址")]):t._e()],1)],1),s("v-uni-view",{staticClass:"task-get box-shadow cell-padding fs30 mgt-30 lh90 bottom-border coupon",on:{click:function(a){a=t.$handleEvent(a),t.goCoupon(a)}}},[""==t.couponList?s("v-uni-text",[t._v("使用优惠券")]):t._e(),""!=t.couponList?s("v-uni-text",[t._v(t._s(t.couponList.name)+" "+t._s(t.couponList.coupon_data.value))]):t._e(),s("v-uni-text",{staticClass:"iconfont icon-jiantou flr"})],1),s("v-uni-view",{staticClass:"task-get box-shadow cell-padding fs30 mgt-30 pay-type"},[s("v-uni-view",{staticClass:"title"},[t._v("选择支付方式")]),s("v-uni-view",{staticClass:"items"},t._l(t.payTypeList,function(a,e){return s("v-uni-view",{key:e,staticClass:"item cf",attrs:{"data-index":e},on:{click:function(a){a=t.$handleEvent(a),t.payTypeCheck(a)}}},[s("v-uni-image",{staticClass:"fll",attrs:{src:a.icon}}),"微信支付"==a.title?s("v-uni-text",{staticClass:"fll mgl-20 text"},[t._v(t._s(a.title))]):t._e(),"余额"==a.title?s("v-uni-text",{staticClass:"fll mgl-20 text"},[t._v(t._s(a.title)+" (￥"+t._s(t.balance_amount||"0")+")")]):t._e(),"鹿币"==a.title?s("v-uni-text",{staticClass:"fll mgl-20 text"},[t._v(t._s(a.title)+" ("+t._s(t.virtual_amount||"0")+")")]):t._e(),s("v-uni-view",{staticClass:"flr check-btn"},[t.payTypeCheckIndex==e?s("v-uni-text",{staticClass:"iconfont icon-dui icon-dui-1 fs40 pdl-10 text-yellow"}):t._e(),t.payTypeCheckIndex!=e?s("v-uni-text",{staticClass:"iconfont icon-dui icon-yuan-1 fs40 pdl-10 text-eb"}):t._e()],1)],1)}),1)],1),s("v-uni-view",{staticStyle:{height:"140upx"}}),t.fetchs.length>0||t.finds.length>0?s("v-uni-view",{staticClass:"task-pay fs30 lh120 box-shadow pdl-30"},[s("v-uni-view",{staticClass:"flr task-paybtn",staticStyle:{"margin-right":"240upx"}},[t._v("应付款："),s("v-uni-text",{staticClass:"text-red"},[t._v("￥"+t._s(t.findsTotalPrice+t.fetchsTotalPrice-t.couponListPrice))])],1),s("v-uni-button",{staticClass:"task-pay-btn text-underline",attrs:{disabled:t.isDisabled},on:{click:function(a){a=t.$handleEvent(a),t.doPay(a)}}},[t._v("支付")])],1):t._e()],1)],1)},i=[];s.d(a,"a",function(){return e}),s.d(a,"b",function(){return i})},c429:function(t,a,s){"use strict";var e=s("87df"),i=s.n(e);i.a},db2e:function(t,a,s){a=t.exports=s("2350")(!1),a.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.fecth-address[data-v-1f1fea4c]{padding-left:%?16?%}.fetchsAddress[data-v-1f1fea4c]{position:relative;top:%?18?%}.task-find-title[data-v-1f1fea4c]{line-height:%?90?%;height:%?90?%;border-bottom:%?1?% solid #f4f4f4;padding-left:%?30?%}.task-find-list[data-v-1f1fea4c]{padding-left:%?40?%;border-bottom:%?1?% solid #f4f4f4;padding:%?30?% 0}.check-box[data-v-1f1fea4c]{display:inline-block;width:%?55?%;padding-left:%?30?%}.task-find-item[data-v-1f1fea4c]{display:inline-block;width:%?640?%;position:relative;padding-left:%?30?%}.task-find-item uni-view[data-v-1f1fea4c]{display:block;height:%?50?%;line-height:%?50?%;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}.task-find-img[data-v-1f1fea4c]{width:%?125?%;height:%?125?%;position:absolute;top:%?0?%;right:%?20?%}.task-find-method[data-v-1f1fea4c]{position:relative}.task-find-method-img[data-v-1f1fea4c]{padding-left:%?30?%}.task-find-method-img uni-image[data-v-1f1fea4c]{width:%?100?%;height:%?100?%;margin-right:%?50?%;border-radius:%?10?%}.task-find-price[data-v-1f1fea4c]{position:absolute;bottom:%?0?%;right:%?20?%}.task-find-method-getfind uni-view[data-v-1f1fea4c]{padding-left:%?16?%;display:block}.task-find-method-getfind[data-v-1f1fea4c]{padding-right:%?30?%}.task-pay[data-v-1f1fea4c]{width:%?680?%;position:fixed;bottom:0;z-index:999;overflow:hidden;background-color:#f8f8f8}.task-pay uni-view[data-v-1f1fea4c]{padding-left:%?30?%}.task-pay-btn[data-v-1f1fea4c]{width:%?200?%;height:100%;line-height:%?120?%;display:inline-block;background-color:#f29800;text-align:center;color:#fff;position:absolute;right:0;top:0;border-radius:0}.task-find-sum[data-v-1f1fea4c]{text-align:right;padding-right:%?20?%;border-top:%?1?% solid #f4f4f4}.bottom-border[data-v-1f1fea4c]{border-bottom:%?1?% solid #f4f4f4}.icon-dizhi[data-v-1f1fea4c]{font-size:%?50?%;position:absolute;top:30%;left:%?-60?%;z-index:999999}.task-sum[data-v-1f1fea4c]{position:absolute;right:%?220?%;top:%?20?%;width:%?550?%;text-align:right}.task-paybtn[data-v-1f1fea4c]{\n  /* position: relative;\n  top: -15upx; */}.address-icon[data-v-1f1fea4c]{position:absolute;right:%?24?%;top:36%}.address[data-v-1f1fea4c]{position:relative;padding-right:%?150?%;padding-bottom:%?30?%}.address .address-info uni-view[data-v-1f1fea4c]{margin-bottom:%?10?%}.icon-chahao[data-v-1f1fea4c]{position:absolute;right:%?10?%;top:%?0?%;font-size:%?50?%;color:#aaa}.remark[data-v-1f1fea4c]{display:inline;text-align:center;border:%?1?% solid #f29800;padding:0 %?4?%;color:#f29800;margin-left:%?20?%}.task-warp[data-v-1f1fea4c]{overflow:hidden}.coupon[data-v-1f1fea4c]{text-align:left;color:#333}.coupon uni-text[data-v-1f1fea4c]:first-child{margin-right:%?20?%}.coupon uni-text[data-v-1f1fea4c]:last-child{position:relative;top:%?0?%}.pay-type .title[data-v-1f1fea4c]{padding:%?20?% %?10?%}.pay-type .items .item[data-v-1f1fea4c]{height:%?60?%;line-height:%?60?%;padding:%?20?% 0}.pay-type .items .item .text[data-v-1f1fea4c]{width:%?500?%}.pay-type .items .item uni-image[data-v-1f1fea4c]{width:%?60?%;height:%?60?%}',""])}}]);