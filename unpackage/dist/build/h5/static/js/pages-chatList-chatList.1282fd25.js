(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chatList-chatList"],{1470:function(t,e,i){"use strict";i.r(e);var n=i("2ca5"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);e["default"]=a.a},"2ca5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("f6ce"));function a(t){return t&&t.__esModule?t:{default:t}}var s={computed:{Screen_width:function(){return uni.getSystemInfoSync().windowWidth}},data:function(){return{img:"../../static/slide-list/qr_code.png",visible:!1,start_slide_x:0,btnWidth:0,startX:0,LastX:0,startTime:0,screenName:"",list:[],btuBottom:"0",secondHeight:"",index:-1,fromUserId:0}},onLoad:function(t){if(this.globalData.initType=1,this.globalData.userId&&""!=this.globalData.userId)n.default.initSocket(this.globalData.userId,this.globalData.toUserId);else{var e=uni.getStorageSync("userInfo").id;if(!e||""==e)return void console.warn("用户id不存在，连接失败！！！");n.default.initSocket(e,t.toUserId),this.fromUserId=e}uni.setStorageSync("token",t.token||uni.getStorageSync("token")),this.globalData.connentSocket&&this.onSend()},onShow:function(){var t=this,e=uni.getSystemInfoSync();this.secondHeight=e.windowHeight,this.globalData.callback=function(e){if(console.log("接收数据:",e),e&&e.length>0){for(var i in e)e[i].slide_x=0;t.list=e}else if(0!=e.fromUserId){var n=t.list.findIndex(function(t,i){return t.userInfoId==e.userInfoId});-1!=n?(t.list[n].userMessage=e,t.list[n].unRead++):t.onSend()}},uni.$on("message",function(e){t.list[t.index].userMessage=e}),uni.$on("chatList",function(e){e&&t.onSend()})},onUnload:function(){uni.$off()},methods:{onSend:function(){var t={fromUserId:this.fromUserId||this.globalData.userId,toUserId:"",content:"page",smsType:"TEXT",sysType:1,smsStatus:10,smsList:!0,currentPage:"",pageSize:""};this.globalData.localSocket.send({data:JSON.stringify(t)})},cancelEvent:function(){this.visible=!1},touchStart:function(t,e){var i=this;this.startTime=t.timeStamp,this.start_slide_x=this.list[e].slide_x,uni.createSelectorQuery().selectAll(".group-btn").boundingClientRect().exec(function(t){null!=t[0]&&(i.btnWidth=-1*t[0][e].width)}),this.startX=t.touches[0].pageX,this.lastX=this.startX,this.list.forEach(function(t,i){i!==e&&(t.slide_x=0)})},touchMove:function(t,e){var i=t.touches[0].pageX,n=i-this.lastX,a=this.list[e].slide_x+n;a<=0&&a>=this.btnWidth&&(this.list[e].slide_x=a),this.lastX=i},touchEnd:function(t,e){var i=10,n=t.timeStamp,a=this.startX-this.lastX;Math.abs(n-this.startTime)>200&&(i=this.btnWidth/-2),this.list[e].slide_x=a>i?this.btnWidth:a<-1*i?0:this.start_slide_x},recover:function(t,e){this.index=e,t.slide_x&&0!=t.slide_x?this.list[e].slide_x=0:(this.list[e].unRead=0,uni.setStorageSync("toAvatarPath",t.toAvatarPath),uni.setStorageSync("fromAvatarPath",t.fromAvatarPath),uni.navigateTo({url:"../chat/chat?name=".concat(t.nickName,"&fromUserId=").concat(this.fromUserId||this.globalData.userId,"&toUserId=").concat(t.toUserId)}))},top:function(t){console.log("点击分享"),this.visible?this.visible=!1:this.visible=!0},removeM:function(t,e){var i=this;uni.showModal({title:"",content:"确定要删除该信息吗？",confirmText:"删除",confirmColor:"#ff3b32",success:function(e){e.confirm?(i.list.splice(t,1),uni.showToast({icon:"success",title:"操作成功!",duration:2e3})):e.cancel&&console.log("用户点击取消")}})}}};e.default=s},"53d8":function(t,e,i){var n=i("c444");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i("4f06").default;a("1f226e74",n,!0,{sourceMap:!1,shadowMode:!1})},"6f2e":function(t,e,i){"use strict";var n=i("53d8"),a=i.n(n);a.a},9070:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"index",style:[{"min-height":t.secondHeight+"px"}]},[i("v-uni-view",{staticClass:"list-box"},t._l(t.list,function(e,n){return i("v-uni-view",{key:n,staticClass:"container_of_slide"},[i("v-uni-view",{staticClass:"slide_list",style:{transform:"translate3d("+e.slide_x+"px, 0, 0)"},on:{touchstart:function(e){e=t.$handleEvent(e),t.touchStart(e,n)},touchend:function(e){e=t.$handleEvent(e),t.touchEnd(e,n)},touchmove:function(e){e=t.$handleEvent(e),t.touchMove(e,n)},click:function(i){i=t.$handleEvent(i),t.recover(e,n)}}},[i("v-uni-view",{staticClass:"now-message-info",style:{width:t.Screen_width+"px"},attrs:{"hover-class":"uni-list-cell-hover"}},[i("v-uni-view",{staticClass:"icon-circle"},[i("v-uni-image",{attrs:{src:e.toAvatarPath}})],1),i("v-uni-view",{staticClass:"list-right"},[i("v-uni-view",{staticClass:"top"},[i("v-uni-view",{staticClass:"username"},[t._v(t._s(e.nickName||e.userName))]),i("v-uni-view",{staticClass:"time"},[t._v(t._s(e.userMessage.dateTime))])],1),i("v-uni-view",{staticClass:"bottom"},[i("v-uni-view",{staticClass:"msg"},[t._v(t._s("TEXT"==e.userMessage.smsType?e.userMessage.content:"[图片]"))]),e.unRead>0?i("v-uni-view",{staticClass:"tis"},[t._v(t._s(e.unRead>99?"99..":e.unRead))]):t._e()],1)],1)],1),i("v-uni-view",{staticClass:"group-btn"},[e.isShare?i("v-uni-view",{staticClass:"top btn-div",on:{click:function(i){i=t.$handleEvent(i),t.top(e.id)}}},[t._v("分享")]):t._e(),i("v-uni-view",{staticClass:"removeM btn-div",on:{click:function(i){i=t.$handleEvent(i),t.removeM(n,e.userInfoId)}}},[t._v("删除")])],1),i("v-uni-view",{staticStyle:{clear:"both"}})],1)],1)}),1),t.visible?i("v-uni-view",{staticClass:"scan-box",attrs:{mode:"top-right"}},[i("v-uni-view",{staticClass:"scan-item"},[i("v-uni-view",{staticClass:"scan-content"},[i("v-uni-view",{staticClass:"scan-icon"},[i("v-uni-image",{staticClass:"scan-icon-img",attrs:{src:"../../static/slide-list/icon-scan.png"}})],1),i("v-uni-image",{staticClass:"scan-btn",attrs:{src:"../../static/slide-list/fork.png"},on:{click:function(e){e=t.$handleEvent(e),t.cancelEvent(e)}}}),i("v-uni-image",{staticClass:"scan-img",attrs:{src:t.img}}),i("v-uni-view",{staticClass:"scan-text"},[t._v("扫一扫查看分享信息")])],1)],1)],1):t._e()],1)},a=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a})},c0bf:function(t,e,i){"use strict";i.r(e);var n=i("9070"),a=i("1470");for(var s in a)"default"!==s&&function(t){i.d(e,t,function(){return a[t]})}(s);i("6f2e");var o=i("2877"),l=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,"0d5a045e",null);e["default"]=l.exports},c444:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.index[data-v-0d5a045e]{background:#f8f8f8}.list-box[data-v-0d5a045e]{padding:%?20?% 0}.container_of_slide[data-v-0d5a045e]{width:100%;overflow:hidden}.slide_list[data-v-0d5a045e]{-webkit-transition:all .1s;-o-transition:all .1s;transition:all .1s;-webkit-transition-timing-function:ease-out;-o-transition-timing-function:ease-out;transition-timing-function:ease-out;min-width:200%;height:%?140?%}.slide_list[data-v-0d5a045e]:before{content:" ";position:absolute;z-index:3;left:%?160?%;bottom:-1px;width:100%;height:1px;border-bottom:1px solid #d9d9d9;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;-webkit-transform:scaleY(.5);-ms-transform:scaleY(.5);transform:scaleY(.5)}.container_of_slide:last-child .slide_list[data-v-0d5a045e]:before{display:none}.now-message-info[data-v-0d5a045e]{-webkit-box-sizing:border-box;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;font-size:16px;clear:both;height:%?140?%;padding:0 %?30?%;background:#fff}.group-btn[data-v-0d5a045e],.now-message-info[data-v-0d5a045e]{float:left}.group-btn[data-v-0d5a045e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;height:%?140?%;min-width:%?100?%;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.group-btn .btn-div[data-v-0d5a045e]{height:%?140?%;color:#fff;text-align:center;padding:0 %?50?%;font-size:%?34?%;line-height:%?140?%}.group-btn .top[data-v-0d5a045e]{background-color:#c4c7cd}.group-btn .removeM[data-v-0d5a045e]{background-color:#ff3b32}.icon-circle[data-v-0d5a045e]{width:%?100?%;height:%?100?%;line-height:%?100?%;text-align:center;color:#fff;font-weight:700;font-size:20px;float:left}.icon-circle uni-image[data-v-0d5a045e]{width:%?100?%;height:%?100?%;-webkit-border-radius:%?20?%;border-radius:%?12?%}.list-right[data-v-0d5a045e]{-webkit-flex-shrink:1;-ms-flex-negative:1;flex-shrink:1;width:98%;padding:%?6?% 0 %?6?% 5%}.list-right .top[data-v-0d5a045e]{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:%?10?%;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:end;-webkit-align-items:flex-end;-ms-flex-align:end;align-items:flex-end}.list-right .top .username[data-v-0d5a045e]{font-size:%?30?%;font-weight:400}.list-right .top .time[data-v-0d5a045e]{font-size:%?25?%;color:#bebebe}.list-right .bottom[data-v-0d5a045e]{width:100%;height:%?40?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}.list-right .bottom .msg[data-v-0d5a045e]{width:90%;font-size:%?25?%;color:#777;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;overflow:hidden;margin-right:%?30?%;text-align:left}.list-right .bottom .tis[data-v-0d5a045e]{padding:%?3?% %?12?%;font-size:%?22?%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;background-color:#eb4d3d;color:#fff;border-radius:%?6?%}.button-box[data-v-0d5a045e]{-webkit-box-sizing:border-box;box-sizing:border-box;position:fixed;left:0;bottom:0;width:100%;z-index:998;background:#f8f8f8}.btn-sub[data-v-0d5a045e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;float:left;width:100%;height:%?100?%;background:#f8f8f8;color:#7fb2ff}.btn-plusempty[data-v-0d5a045e]{width:%?110?%;height:%?110?%;background:#007bfa;position:fixed;bottom:%?50?%;right:%?20?%;border-radius:100%;overflow:hidden;text-align:center;line-height:%?110?%}.empty[data-v-0d5a045e]{color:#999}.plusempty-img[data-v-0d5a045e]{width:%?50?%;height:%?50?%;margin-top:%?30?%}.scan-box[data-v-0d5a045e]{display:block;position:fixed;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,.3);z-index:99999}.scan-item[data-v-0d5a045e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;margin:0 auto;width:80%;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-sizing:border-box;box-sizing:border-box;opacity:1}.scan-content[data-v-0d5a045e]{position:relative;width:%?400?%;height:%?500?%;background:#fff;border-radius:%?20?%}.scan-icon[data-v-0d5a045e]{position:absolute;top:%?-50?%;left:%?150?%;width:%?100?%;height:%?100?%;border-radius:100%;-webkit-box-sizing:border-box;box-sizing:border-box;background:#fff;padding:%?20?%}.scan-icon-img[data-v-0d5a045e]{width:100%;height:100%}.scan-text[data-v-0d5a045e]{position:absolute;bottom:%?40?%;left:0;width:100%;text-align:center;font-size:14px}.scan-share[data-v-0d5a045e]{width:100%;height:100%}.scan-img[data-v-0d5a045e]{width:%?300?%;height:%?300?%;margin:auto;display:block;position:absolute;top:%?80?%;left:%?50?%;z-index:99}.scan-btn[data-v-0d5a045e]{top:%?-30?%;left:auto;right:%?-30?%;bottom:auto;position:absolute;width:%?64?%;height:%?64?%;border-radius:50%;z-index:99999;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.uni-list-cell-hover[data-v-0d5a045e]{background-color:#eee}.bottom-btn-hover[data-v-0d5a045e]{background:#0564c7!important}',""])},f6ce:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("c073"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return n.default.connentSocket?(console.warn("连接已存在！"),!1):t&&""!=t?2==n.default.initType&&""==e?(console.error("用户id为空连接失败！"),!1):(n.default.localSocket=wx.connectSocket({url:"".concat(n.default.url,"/notice/socket?userId=").concat(t,"&openType=sms"),success:function(){n.default.userId=t,2==n.default.initType&&(n.default.toUserId=e),n.default.connentSocket=!0}}),n.default.localSocket.onOpen(function(i){console.log("socket连接成功，initType = "+n.default.initType),1==n.default.initType?d(t):2==n.default.initType&&u(t,e),n.default.connentSocket=!0,r(),n.default.connectTime=3e3}),n.default.localSocket.onError(function(t){n.default.connentSocket=!1,l(),n.default.connectTime=2*n.default.connectTime}),n.default.localSocket.onClose(function(t){n.default.connentSocket=!1}),void n.default.localSocket.onMessage(function(t){var e=JSON.parse(t.data);if(console.log("收到消息",e),!e.length&&!e.currentPage&&0!=e.fromUserId){var i={id:e.id,fromUserId:0,toUserId:e.fromUserId,messageId:e.messageId,content:"page",smsType:"TEXT",sysType:1,smsStatus:40,smsList:!1,currentPage:"",pageSize:""};o(JSON.stringify(i))}n.default.callback(e),c()})):(console.error("用户id为空连接失败！"),!1)}function o(t){return new Promise(function(e,i){n.default.connentSocket&&n.default.localSocket.send({data:t,success:function(t){e(t)},fail:function(t){i(t)}})})}function l(){if(n.default.lockReconnect)return!1;n.default.lockReconnect=!0,n.default.timeoutNum&&clearTimeout(n.default.timeoutNum),n.default.timeoutNum=setTimeout(function(){n.default.userId&&""!=n.default.userId&&(s(n.default.userId,n.default.toUserId),n.default.lockReconnect=!1)},n.default.connectTime)}function c(){clearTimeout(n.default.timeoutObj),r()}function r(){n.default.timeoutObj&&clearTimeout(n.default.timeoutObj),n.default.timeoutObj=setTimeout(function(){if(n.default.connentSocket){var t={id:0,fromUserId:0,toUserId:0,userInfoId:0,content:"ping",smsType:"TEXT",sysType:1,smsStatus:10,smsList:!1,currentPage:"",pageSize:""};o(JSON.stringify(t))}else l()},n.default.timeout)}function d(t){var e={fromUserId:t,toUserId:"",content:"page",smsType:"TEXT",sysType:1,smsStatus:10,smsList:!0,currentPage:"",pageSize:""};console.log("获取聊天列表！！！"),o(JSON.stringify(e))}function u(t,e){var i={fromUserId:t,toUserId:e,content:"page",smsType:"TEXT",sysType:1,smsStatus:10,smsList:!1,currentPage:1,pageSize:15};console.log("获取聊天历史！！！"),o(JSON.stringify(i))}var f={initSocket:s};e.default=f}}]);