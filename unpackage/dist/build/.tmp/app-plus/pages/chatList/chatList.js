(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chatList/chatList"],{1470:function(t,s,e){"use strict";e.r(s);var i=e("67a9"),a=e.n(i);for(var n in i)"default"!==n&&function(t){e.d(s,t,function(){return i[t]})}(n);s["default"]=a.a},"67a9":function(t,s,e){"use strict";(function(t){Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var i=a(e("f6ce"));function a(t){return t&&t.__esModule?t:{default:t}}var n={computed:{Screen_width:function(){return t.getSystemInfoSync().windowWidth}},data:function(){return{img:"../../static/slide-list/qr_code.png",visible:!1,start_slide_x:0,btnWidth:0,startX:0,LastX:0,startTime:0,screenName:"",list:[],btuBottom:"0",secondHeight:"",index:-1,fromUserId:0}},onLoad:function(s){if(this.globalData.initType=1,this.globalData.userId&&""!=this.globalData.userId)i.default.initSocket(this.globalData.userId,this.globalData.toUserId);else{var e=t.getStorageSync("userInfo").id;if(!e||""==e)return void console.warn("用户id不存在，连接失败！！！");i.default.initSocket(e,s.toUserId),this.fromUserId=e}t.setStorageSync("token",s.token||t.getStorageSync("token")),this.globalData.connentSocket&&this.onSend()},onShow:function(){var s=this,e=t.getSystemInfoSync();this.secondHeight=e.windowHeight,this.globalData.callback=function(t){if(console.log("接收数据:",t),t&&t.length>0){for(var e in t)t[e].slide_x=0;s.list=t}else if(0!=t.fromUserId){var i=s.list.findIndex(function(s,e){return s.userInfoId==t.userInfoId});-1!=i?(s.list[i].userMessage=t,s.list[i].unRead++):s.onSend()}},t.$on("message",function(t){s.list[s.index].userMessage=t}),t.$on("chatList",function(t){t&&s.onSend()})},onUnload:function(){t.$off()},methods:{onSend:function(){var t={fromUserId:this.fromUserId||this.globalData.userId,toUserId:"",content:"page",smsType:"TEXT",sysType:1,smsStatus:10,smsList:!0,currentPage:"",pageSize:""};this.globalData.localSocket.send({data:JSON.stringify(t)})},cancelEvent:function(){this.visible=!1},touchStart:function(s,e){var i=this;this.startTime=s.timeStamp,this.start_slide_x=this.list[e].slide_x,t.createSelectorQuery().selectAll(".group-btn").boundingClientRect().exec(function(t){null!=t[0]&&(i.btnWidth=-1*t[0][e].width)}),this.startX=s.touches[0].pageX,this.lastX=this.startX,this.list.forEach(function(t,s){s!==e&&(t.slide_x=0)})},touchMove:function(t,s){var e=t.touches[0].pageX,i=e-this.lastX,a=this.list[s].slide_x+i;a<=0&&a>=this.btnWidth&&(this.list[s].slide_x=a),this.lastX=e},touchEnd:function(t,s){var e=10,i=t.timeStamp,a=this.startX-this.lastX;Math.abs(i-this.startTime)>200&&(e=this.btnWidth/-2),this.list[s].slide_x=a>e?this.btnWidth:a<-1*e?0:this.start_slide_x},recover:function(s,e){this.index=e,s.slide_x&&0!=s.slide_x?this.list[e].slide_x=0:(this.list[e].unRead=0,t.setStorageSync("toAvatarPath",s.toAvatarPath),t.setStorageSync("fromAvatarPath",s.fromAvatarPath),t.navigateTo({url:"../chat/chat?name=".concat(s.nickName,"&fromUserId=").concat(this.fromUserId||this.globalData.userId,"&toUserId=").concat(s.toUserId)}))},top:function(t){console.log("点击分享"),this.visible?this.visible=!1:this.visible=!0},removeM:function(s,e){var i=this;t.showModal({title:"",content:"确定要删除该信息吗？",confirmText:"删除",confirmColor:"#ff3b32",success:function(e){e.confirm?(i.list.splice(s,1),t.showToast({icon:"success",title:"操作成功!",duration:2e3})):e.cancel&&console.log("用户点击取消")}})}}};s.default=n}).call(this,e("6e42")["default"])},"899d":function(t,s,e){"use strict";var i=e("f21f"),a=e.n(i);a.a},"8cdd":function(t,s,e){"use strict";var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("view",{staticClass:"index",style:[{"min-height":t.secondHeight+"px"}]},[e("view",{staticClass:"list-box"},t._l(t.list,function(s,i){return e("view",{key:i,staticClass:"container_of_slide"},[e("view",{staticClass:"slide_list",style:{transform:"translate3d("+s.slide_x+"px, 0, 0)"},attrs:{eventid:"2c59a812-2-"+i},on:{touchstart:function(s){t.touchStart(s,i)},touchend:function(s){t.touchEnd(s,i)},touchmove:function(s){t.touchMove(s,i)},tap:function(e){t.recover(s,i)}}},[e("view",{staticClass:"now-message-info",style:{width:t.Screen_width+"px"},attrs:{"hover-class":"uni-list-cell-hover"}},[e("view",{staticClass:"icon-circle"},[e("image",{attrs:{src:s.toAvatarPath}})]),e("view",{staticClass:"list-right"},[e("view",{staticClass:"top"},[e("view",{staticClass:"username"},[t._v(t._s(s.nickName||s.userName))]),e("view",{staticClass:"time"},[t._v(t._s(s.userMessage.dateTime))])]),e("view",{staticClass:"bottom"},[e("view",{staticClass:"msg"},[t._v(t._s("TEXT"==s.userMessage.smsType?s.userMessage.content:"[图片]"))]),s.unRead>0?e("view",{staticClass:"tis"},[t._v(t._s(s.unRead>99?"99..":s.unRead))]):t._e()])])]),e("view",{staticClass:"group-btn"},[s.isShare?e("view",{staticClass:"top btn-div",attrs:{eventid:"2c59a812-0-"+i},on:{tap:function(e){t.top(s.id)}}},[t._v("分享")]):t._e(),e("view",{staticClass:"removeM btn-div",attrs:{eventid:"2c59a812-1-"+i},on:{tap:function(e){t.removeM(i,s.userInfoId)}}},[t._v("删除")])]),e("view",{staticStyle:{clear:"both"}})])])})),t.visible?e("view",{staticClass:"scan-box",attrs:{mode:"top-right"}},[e("view",{staticClass:"scan-item"},[e("view",{staticClass:"scan-content"},[t._m(0),e("image",{staticClass:"scan-btn",attrs:{src:"../../static/slide-list/fork.png",eventid:"2c59a812-3"},on:{click:t.cancelEvent}}),e("image",{staticClass:"scan-img",attrs:{src:t.img}}),e("view",{staticClass:"scan-text"},[t._v("扫一扫查看分享信息")])])])]):t._e()])},a=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("view",{staticClass:"scan-icon"},[e("image",{staticClass:"scan-icon-img",attrs:{src:"../../static/slide-list/icon-scan.png"}})])}];e.d(s,"a",function(){return i}),e.d(s,"b",function(){return a})},c0bf:function(t,s,e){"use strict";e.r(s);var i=e("8cdd"),a=e("1470");for(var n in a)"default"!==n&&function(t){e.d(s,t,function(){return a[t]})}(n);e("899d");var o=e("2877"),c=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"2843c33e",null);s["default"]=c.exports},e538:function(t,s,e){"use strict";e("a3d9");var i=n(e("b0ce")),a=n(e("c0bf"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},f21f:function(t,s,e){}},[["e538","common/runtime","common/vendor"]]]);